#!/bin/bash

# Function to prompt the user
prompt_user() {
  echo "UpgrayeDD wants to know, do you want to reboot or shutdown? (r for reboot / s for shutdown) - A pimp's gotta choose!"
  echo "You have 15 seconds to choose, otherwise UpgrayeDD will reboot your ass..."
}

# Set a timeout for the user's input
read_user_input() {
  read -t 15 -p "Choose wisely: " choice
}

# Function to handle the user's choice
handle_choice() {
  case $choice in
    r|R)
      echo "UpgrayeDD is rebooting the system..."
      sudo reboot now
      ;;
    s|S)
      echo "UpgrayeDD is shutting down the system..."
      sudo shutdown now
      ;;
    *)
      echo "UpgrayeDD is didn't hear shit from you. Rebooting by default..."
      sudo reboot now
      ;;
  esac
}

clear
echo "*******************************"
echo "***** UPGREYEDD RESUMING ******"
echo "*******************************"
cd rc-lap-timer
echo "*** UpgrayeDD untarring"
tar xzf ../rc-lap-timer-build.tar.gz

echo "*** UpgrayeDD copying files"
sudo mkdir -p /var/www/rc-lap-timer
sudo cp -r .next/* /var/www/rc-lap-timer/

echo "*** UpgrayeDD prisma magic"
npx prisma generate
npx prisma db push

echo "*** UpgrayeDD owning shit left and right"
sudo chown -R pi:pi /home/pi/rc-lap-timer

echo "*** UpgrayeDD copying system utilities"
#!/bin/bash

# Copy database files to home directory
cp -f ~/rc-lap-timer/scripts/database/backupDB.sql ~/
cp -f ~/rc-lap-timer/scripts/database/clearDB.sql ~/

# Copy system files to home directory
cp -f ~/rc-lap-timer/scripts/system/backupDB.sh ~/
cp -f ~/rc-lap-timer/scripts/system/piUpgrade1.sh ~/
cp -f ~/rc-lap-timer/scripts/system/piUpgrade2.sh ~/
cp -f ~/rc-lap-timer/scripts/system/restoreDB.sh ~/
cp -f ~/rc-lap-timer/scripts/system/upgrayedd.sh ~/

# Copy motd file to /etc (requires sudo)
sudo cp -f ~/rc-lap-timer/misc/etc/motd /etc/motd

# Make the scripts executable
cd ~
sudo chmod +x *.sh

# Verify all files were copied successfully
echo "Verifying files..."
files_to_check=(
    "~/backupDB.sql"
    "~/clearDB.sql"
    "~/backupDB.sh"
    "~/piUpgrade1.sh"
    "~/piUpgrade2.sh"
    "~/restoreDB.sh"
    "~/upgrayedd.sh"
    "/etc/motd"
)

all_files_exist=true
for file in "${files_to_check[@]}"; do
    if [ ! -f "$(eval echo $file)" ]; then
        echo "Warning: $file was not copied successfully"
        all_files_exist=false
    fi
done

if $all_files_exist; then
    echo "All files were copied successfully"
else
    echo "Some files were not copied successfully. Please check the warnings above."
    exit 1
fi


echo "*** UpgrayeDD asking what you want!"
echo "--------------------------------------------------------------------------------------------------------------------"
echo "--------------------------------------------------------======------------------------------------------------------"
echo "------------------------------------------------=+*#****++****#####*+-----------------------------------------------"
echo "--------------------------------------------=*#*+++++********#%%%%##*##*=-------------------------------------------"
echo "------------------------------------------+#+++***************#%%@@%%#+=**------------------------------------------"
echo "----------------------------------------+#==******************##%%%@%#*=-**-----------=*+-====----------------------"
echo "---------------------------------------#*:-+******************##%%@@%%#+-=#=-----+*#**%*++==+*##%#*=----------------"
echo "--------------------------------------+%.:=+*********##%%%%%%%%%%@@@@%#*=-#+---*#****########**++++*##+-------------"
echo "--------------------------------------+%.:=+****#%#**++++++**###%%%%%%%%#+*##%%#####*****##*****#%#*+++**=----------"
echo "--------------------------------------+%.:=*#%*+**+**+++++***###%%%%%%%%%@@@@%%%##***##%@@@@%%###+*##+=+%@#---------"
echo "--------------------------------------+#.-#*+###***+++++****##%%@@%#*++++**##############*++#@@@@%*+*%#+==%---------"
echo "--------------------------------------+@#=+*####*******#%%%%#**##%%###%####################**++%**@#+*#%*+*%=-------"
echo "--------------------------------------*#:=######*#%@%#**#%%%%%##############################***-#*-*%*+%#=+@%-------"
echo "--------------------------------------*#:*#%%@%%###%@@@@@@@@@@@@@@@@@@@@@@@@%%##########*#****++:%+=####%*==#-------"
echo "-------------------------------------=#@@%###@@@@@@@@@@@@@@@@%%%#####%@@@@@@@@@@%%%####*#***++++:+#-=##=##=+#*------"
echo "--------------------------------=*%@%*#%@@@@@@@@@@@@%%%##########%%%%%%@@@@@@##@@@@%#%##**+*++=+:+#--+*=#%=:#*------"
echo "----------------------------*%@%*#%@@@@@@@@#=+#%%@@@@@@@%#@*%@@@@@@@@@%#+*@@%%**@@@%#%#%#*+*+*==:#*--=###%=#+*------"
echo "------------------------+%%*+%@@@@@@@@@@@@%*#%@@@@@@@@@@#-=-+:+%@@@@@@@@%+%@@**%@@%%%#%*%+#++++:=@---+*-*%==%+------"
echo "---------------------*%#+#@@@@@@@@@@@@@@@@#+*+====*%@@@@+#%#*@@@@#%@@@@@@*+%@#*@@@@%%%#@+#+*+=-=@=--=##*%#==%-------"
echo "-------------------##=*%#%%%%%%@@@@@@@@@@@**@@@@@@@@@@@*%#+#%*@@@@@@@@@@@*+%@##%%@@%%%%##+*+=-+%=----***#=%#=-------"
echo "-----------------*#-%######%%%%%@@@@@@@@@@%##%%%%%%%%#*#+::=##*%%%%%%%%%#*%@@#++@@@@@#@*#++--#*-----+%#%*+@=--------"
echo "----------------+%=%######%##%%%%@@@@@@@%@@#*###******#*=::-+####****###**#@%#*#@@@@@#%++=-*#=-----=*#%*%#----------"
echo "----------------+#=####%%%%%%%@%@@@@@@@%@@%+**++++**##*##***#%##%#******#*+%@#%@@@@@%#+==##=------=#%###=-----------"
echo "-----------------*#-*###%%%%%%@%%@@@@@@@#@%=-***+=-=*##**#@%###%#*-=**#*+:*@%#*@@%%*==*%*-------=*%#%*=-------------"
echo "------------------=%*=*###%%%%%@%%%%@@@%**%#:-++=-+#+++*####%##*++#=+##+:-#%##+%*++##+:..:-----=++=-----------------"
echo "---------------------*#*+**#%%%%%@@%%@@%=#@#-.=+++*+#%#**+=+**#%@#+#*##+:-##%+*%#*-.......:-------------------------"
echo "------------------------+###***###%%@@@@*=*%=.=++**%#*#%%%###%%%#%@*###+-=%#=#=............:------------------------"
echo "-----------------------------+*####*****#%*%+.-+++####+=--=--=+*###%##*=:=##%:.............:------------------------"
echo "-------------------------------.......::--+@*:.-++++++*#@@@@@%#****##*+-:*%##...............:-----------------------"
echo "------------------------------:...........=%@+..-++++++++*+++++**##**-::=%##+::..............:----------------------"
echo "------------------------------.............=%@#-..-++++=:::::-+*##*=-::+%@#=:................:----------------------"
echo "-----------------------------:..............:#=+#+::=+++====+**#*=:-+##=**:...................----------------------"
echo "-----------------------------................++.-*%#+++**###%##++*%@@%+-*+....................:---------------------"
echo "-----------------------------...............-##::+*#%@@%%@@@%%%@@@@@@#==%#-...................:---------------------"
echo "-----------------------------.............:+#%**:+**++*%%@@@@@@@@@@@%*+**#%*:.................:---------------------"
echo "-----------------------------............-***#:-#***+=-=++*##%@@@@@@%%+-=%#+%*:...............:---------------------"
echo "-----------------------------..........:*+-+@#:..=%%*=--=+**##%%@@@@+-:-+%@#-+#*:.............:---------------------"
echo "-----------------------------......:-*#*-=+%@%-....=#%+--+**##%%@%=::==-*#%%*=+=##*-:.........:---------------------"
echo "-----------------------------:.-+##+#%-:+=#@%%+:.....-*%#***#%%*-.:=-+-=##%%#+**=+%**##+-:....----------------------"
echo "--------------------------=*%#+---+#=-=*=#%@%#*-........-#@%*-....==---***%@%*+#*+=#%*+==+##+-----------------------"
echo "---------------------=*##*=:::=+*%*=+**=*##*#*%-:......-##*##-...:-::-=#+%**@=**##*+*%#%#+=--=*%%*=-----------------"
echo "----------------=*%#+-::::==***#%++****=*%%#%*#+-:....+#*+**#%+.....:-#+*%%#@+***###*+%%###*+==-:-=*#%*=------------"
echo "-----------=+#%*-:.::==++++***%#+******#%%*=##*%::...+%*+++**#%=...:-+#=##=*@#%**###****@###**+++++----=+#%#+-------"
echo "--------=%*#+.:--=+=+++*****#%=*******%+*%**%#+%+-:.-%%#*++*##%%-.:-=%=*%*=#@:#%#*******+%%******+**+++=+---####=---"
echo "--------%=:#*=+++++*******#%=+******%*=*#@@%%#**%:::*#%##***##%%+::-%++%#%%@%:**%#********#%#***********+*+=%*=**---"
echo "-------+%:*##************%#+******#%=+**#@%*+##+@=:=#-=%@#%%@%==#-:+#=#%#+*#*=**+*%*********%#**************%*++*=--"
echo "-------*#:*#%*************#@%****#*+***##%*=+%#**#-*+.-#-:*#%#::**-@-*%*=*#%+=***++%#****#@%#***********####%+++#=--"
echo "-------**:**%**#****#%%#****#@@%%++****##@%##@#*+@**::#=::*#%%*::##++%%#%@%%-******=#%#@@%#***##%******####%#*+=#=--"
echo "-------+*.+*%#*******%-:-+#%@@@#=*******#@##+-+%*#%-:*==--**#%#=:+%-@#**+=%%-*******++@@@@#*=--%@#*****##**@**=-#=--"
echo "-------#+.-*#%*******%*-*****+==********#@@%+=#@*+%=*+-**-###%##=#=#@-=%%*#*=********+=+****+=%@%#*****##*#%+*=:#*--"
echo "------=#:.=*#%#******#%+=****************@#+##=##*##*+##+-*#####%*+%=@#**%@=+***********#%#*=#@%%#****####@***=-=#=-"
echo "------+*:-=+*%%******#%#=+***************%%%#-:-#%#@*=+-##***###%%@===###@#-+**************+#@@%#****#####@+***-:#+-"
echo "------#+:-+**#%#*****#%@*=***************#@#*%@%+*%#*++-#***###%@==@@*=##%+=+*************+*@%##****#####%%****+:+#-"
echo "-----*#::=+*+*%##****##%%=+**************#@#+##*==#%%**++***##%%#*=*@#+#%#-=***************%@%%*=@#*#####@**##*+=:##"
echo "----=#=.==+##*#%###*+*#%@#=+**************@@%#*#%*-=*%#*****#*+==%+=##%##*-+**************%@#*=::@%%#=+%%%**%##*+-=@"
echo "----=#=-=**#%##%#%#****#%@*=**************%@%%#*=+#%%%%##%#**-#%=-#*%***%==**************%%*=::==@%-:-+%@##@%%##*==@"
echo "-----*=+**%%%%%%%%%%#+**#%@=+*************#@%#%##%##%*=+%+:##*+%#+*%***%#-+*************%%+::-=##*:-+**%%%@%%%%#**+#"
echo "-------=*##%#%%@%%%%##****%@-+*************%@%#%*=--**#**+-%#+=*+*%***%%+-*************#%-=*+=#%+:=+#*#@@@%%%%%#*+--"
echo "----------++*##@@%%%%#*+***%%-+************#@%#**#%%#*####+%#+#%%#***#%#=+************#@*#+--#%+-+%##*@@@@####*=----"
echo "--------------=+#######*****%#-*************%@%#****#%*##%%@@@#**+*##%%*-************#@%+=++#%++#@%%%#*%%++=--------"
echo "--------------------==++++++*%*=************#@%%#****#@#%*@%%#+*++###%%=+***********#@%##********++++==-------------"
echo "------------------------------=-=++++********%%%#***##+-+-**##*++*###%*=***********#@#**++++===---------------------"
echo "-----------------------------------------====+*+*+*#=*%*%=@%*#*+++****-=+++=======-==-------------------------------"

prompt_user
read_user_input
handle_choice
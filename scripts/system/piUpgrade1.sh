#!/bin/bash

# Start the timer
start_time=$(date +%s)

# Green LED
curl -s -o /dev/null http://127.0.0.1:5000/led/0/100/0 2>/dev/null

clear
echo "--------------------------------------------------------------------------------------------------------------------"
echo "--------------------------------------------------------======------------------------------------------------------"
echo "------------------------------------------------=+*#****++****#####*+-----------------------------------------------"
echo "--------------------------------------------=*#*+++++********#%%%%##*##*=-------------------------------------------"
echo "------------------------------------------+#+++***************#%%@@%%#+=**------------------------------------------"
echo "----------------------------------------+#==******************##%%%@%#*=-**-----------=*+-====----------------------"
echo "---------------------------------------#*:-+******************##%%@@%%#+-=#=-----+*#**%*++==+*##%#*=----------------"
echo "--------------------------------------+%.:=+*********##%%%%%%%%%%@@@@%#*=-#+---*#****########**++++*##+-------------"
echo "--------------------------------------+%.:=+****#%#**++++++**###%%%%%%%%#+*##%%#####*****##*****#%#*+++**=----------"
echo "--------------------------------------+%.:=*#%*+**+**+++++***###%%%%%%%%%@@@@%%%##***##%@@@@%%###+*##+=+%@#---------"
echo "--------------------------------------+#.-#*+###***+++++****##%%@@%#*++++**##############*++#@@@@%*+*%#+==%---------"
echo "--------------------------------------+@#=+*####*******#%%%%#**##%%###%####################**++%**@#+*#%*+*%=-------"
echo "--------------------------------------*#:=######*#%@%#**#%%%%%##############################***-#*-*%*+%#=+@%-------"
echo "--------------------------------------*#:*#%%@%%###%@@@@@@@@@@@@@@@@@@@@@@@@%%##########*#****++:%+=####%*==#-------"
echo "-------------------------------------=#@@%###@@@@@@@@@@@@@@@@%%%#####%@@@@@@@@@@%%%####*#***++++:+#-=##=##=+#*------"
echo "--------------------------------=*%@%*#%@@@@@@@@@@@@%%%##########%%%%%%@@@@@@##@@@@%#%##**+*++=+:+#--+*=#%=:#*------"
echo "----------------------------*%@%*#%@@@@@@@@#=+#%%@@@@@@@%#@*%@@@@@@@@@%#+*@@%%**@@@%#%#%#*+*+*==:#*--=###%=#+*------"
echo "------------------------+%%*+%@@@@@@@@@@@@%*#%@@@@@@@@@@#-=-+:+%@@@@@@@@%+%@@**%@@%%%#%*%+#++++:=@---+*-*%==%+------"
echo "---------------------*%#+#@@@@@@@@@@@@@@@@#+*+====*%@@@@+#%#*@@@@#%@@@@@@*+%@#*@@@@%%%#@+#+*+=-=@=--=##*%#==%-------"
echo "-------------------##=*%#%%%%%%@@@@@@@@@@@**@@@@@@@@@@@*%#+#%*@@@@@@@@@@@*+%@##%%@@%%%%##+*+=-+%=----***#=%#=-------"
echo "-----------------*#-%######%%%%%@@@@@@@@@@%##%%%%%%%%#*#+::=##*%%%%%%%%%#*%@@#++@@@@@#@*#++--#*-----+%#%*+@=--------"
echo "----------------+%=%######%##%%%%@@@@@@@%@@#*###******#*=::-+####****###**#@%#*#@@@@@#%++=-*#=-----=*#%*%#----------"
echo "----------------+#=####%%%%%%%@%@@@@@@@%@@%+**++++**##*##***#%##%#******#*+%@#%@@@@@%#+==##=------=#%###=-----------"
echo "-----------------*#-*###%%%%%%@%%@@@@@@@#@%=-***+=-=*##**#@%###%#*-=**#*+:*@%#*@@%%*==*%*-------=*%#%*=-------------"
echo "------------------=%*=*###%%%%%@%%%%@@@%**%#:-++=-+#+++*####%##*++#=+##+:-#%##+%*++##+:..:-----=++=-----------------"
echo "---------------------*#*+**#%%%%%@@%%@@%=#@#-.=+++*+#%#**+=+**#%@#+#*##+:-##%+*%#*-.......:-------------------------"
echo "------------------------+###***###%%@@@@*=*%=.=++**%#*#%%%###%%%#%@*###+-=%#=#=............:------------------------"
echo "-----------------------------+*####*****#%*%+.-+++####+=--=--=+*###%##*=:=##%:.............:------------------------"
echo "-------------------------------.......::--+@*:.-++++++*#@@@@@%#****##*+-:*%##...............:-----------------------"
echo "------------------------------:...........=%@+..-++++++++*+++++**##**-::=%##+::..............:----------------------"
echo "------------------------------.............=%@#-..-++++=:::::-+*##*=-::+%@#=:................:----------------------"
echo "-----------------------------:..............:#=+#+::=+++====+**#*=:-+##=**:...................----------------------"
echo "-----------------------------................++.-*%#+++**###%##++*%@@%+-*+....................:---------------------"
echo "-----------------------------...............-##::+*#%@@%%@@@%%%@@@@@@#==%#-...................:---------------------"
echo "-----------------------------.............:+#%**:+**++*%%@@@@@@@@@@@%*+**#%*:.................:---------------------"
echo "-----------------------------............-***#:-#***+=-=++*##%@@@@@@%%+-=%#+%*:...............:---------------------"
echo "-----------------------------..........:*+-+@#:..=%%*=--=+**##%%@@@@+-:-+%@#-+#*:.............:---------------------"
echo "-----------------------------......:-*#*-=+%@%-....=#%+--+**##%%@%=::==-*#%%*=+=##*-:.........:---------------------"
echo "-----------------------------:.-+##+#%-:+=#@%%+:.....-*%#***#%%*-.:=-+-=##%%#+**=+%**##+-:....----------------------"
echo "--------------------------=*%#+---+#=-=*=#%@%#*-........-#@%*-....==---***%@%*+#*+=#%*+==+##+-----------------------"
echo "---------------------=*##*=:::=+*%*=+**=*##*#*%-:......-##*##-...:-::-=#+%**@=**##*+*%#%#+=--=*%%*=-----------------"
echo "----------------=*%#+-::::==***#%++****=*%%#%*#+-:....+#*+**#%+.....:-#+*%%#@+***###*+%%###*+==-:-=*#%*=------------"
echo "-----------=+#%*-:.::==++++***%#+******#%%*=##*%::...+%*+++**#%=...:-+#=##=*@#%**###****@###**+++++----=+#%#+-------"
echo "--------=%*#+.:--=+=+++*****#%=*******%+*%**%#+%+-:.-%%#*++*##%%-.:-=%=*%*=#@:#%#*******+%%******+**+++=+---####=---"
echo "--------%=:#*=+++++*******#%=+******%*=*#@@%%#**%:::*#%##***##%%+::-%++%#%%@%:**%#********#%#***********+*+=%*=**---"
echo "-------+%:*##************%#+******#%=+**#@%*+##+@=:=#-=%@#%%@%==#-:+#=#%#+*#*=**+*%*********%#**************%*++*=--"
echo "-------*#:*#%*************#@%****#*+***##%*=+%#**#-*+.-#-:*#%#::**-@-*%*=*#%+=***++%#****#@%#***********####%+++#=--"
echo "-------**:**%**#****#%%#****#@@%%++****##@%##@#*+@**::#=::*#%%*::##++%%#%@%%-******=#%#@@%#***##%******####%#*+=#=--"
echo "-------+*.+*%#*******%-:-+#%@@@#=*******#@##+-+%*#%-:*==--**#%#=:+%-@#**+=%%-*******++@@@@#*=--%@#*****##**@**=-#=--"
echo "-------#+.-*#%*******%*-*****+==********#@@%+=#@*+%=*+-**-###%##=#=#@-=%%*#*=********+=+****+=%@%#*****##*#%+*=:#*--"
echo "------=#:.=*#%#******#%+=****************@#+##=##*##*+##+-*#####%*+%=@#**%@=+***********#%#*=#@%%#****####@***=-=#=-"
echo "------+*:-=+*%%******#%#=+***************%%%#-:-#%#@*=+-##***###%%@===###@#-+**************+#@@%#****#####@+***-:#+-"
echo "------#+:-+**#%#*****#%@*=***************#@#*%@%+*%#*++-#***###%@==@@*=##%+=+*************+*@%##****#####%%****+:+#-"
echo "-----*#::=+*+*%##****##%%=+**************#@#+##*==#%%**++***##%%#*=*@#+#%#-=***************%@%%*=@#*#####@**##*+=:##"
echo "----=#=.==+##*#%###*+*#%@#=+**************@@%#*#%*-=*%#*****#*+==%+=##%##*-+**************%@#*=::@%%#=+%%%**%##*+-=@"
echo "----=#=-=**#%##%#%#****#%@*=**************%@%%#*=+#%%%%##%#**-#%=-#*%***%==**************%%*=::==@%-:-+%@##@%%##*==@"
echo "-----*=+**%%%%%%%%%%#+**#%@=+*************#@%#%##%##%*=+%+:##*+%#+*%***%#-+*************%%+::-=##*:-+**%%%@%%%%#**+#"
echo "-------=*##%#%%@%%%%##****%@-+*************%@%#%*=--**#**+-%#+=*+*%***%%+-*************#%-=*+=#%+:=+#*#@@@%%%%%#*+--"
echo "----------++*##@@%%%%#*+***%%-+************#@%#**#%%#*####+%#+#%%#***#%#=+************#@*#+--#%+-+%##*@@@@####*=----"
echo "--------------=+#######*****%#-*************%@%#****#%*##%%@@@#**+*##%%*-************#@%+=++#%++#@%%%#*%%++=--------"
echo "--------------------==++++++*%*=************#@%%#****#@#%*@%%#+*++###%%=+***********#@%##********++++==-------------"
echo "------------------------------=-=++++********%%%#***##+-+-**##*++*###%*=***********#@#**++++===---------------------"
echo "-----------------------------------------====+*+*+*#=*%*%=@%*#*+++****-=+++=======-==-------------------------------"
echo "******************************"
echo "***** UPGREYEDD ENGAGED ******"
echo "* With two D's for a double  *"
echo "*   dose of that pimpin!     *"
echo "******************************"
echo "*** UpgrayeDD backing up your database"
# Red LED
curl -s -o /dev/null http://127.0.0.1:5000/led/100/0/0 2>/dev/null
./backupDB.sh
# Green LED
curl -s -o /dev/null http://127.0.0.1:5000/led/0/100/0 2>/dev/null
echo "*** UpgrayeDD deleting project folder"
rm -rf rc-lap-timer
echo "*** UpgrayeDD deleting tar file"
rm rc-lap-timer-build.tar.gz
echo "*** UpgrayeDD deleting system files"
rm backupDB.sql
rm clearDB.sql
rm create_rc_timer_database.sql
rm backupDB.sh
rm restoreDB.sh
echo "*** UpgrayeDD deleting var/www"
sudo rm -rf /var/www/rc-lap-timer/
echo "*** UpgrayeDD making a new home"
mkdir rc-lap-timer
cd rc-lap-timer
echo "*** UpgrayeDD creating .env file"
cat > .env << 'EOF'
DATABASE_URL="mysql://rc_timer_user:password1@localhost:3306/rc_lap_timer"
EOF

# End the timer
end_time=$(date +%s)

# Calculate the time difference
time_diff=$((end_time - start_time))

# Convert to minutes and seconds for readability
minutes=$((time_diff / 60))
seconds=$((time_diff % 60))

# Red LED
curl -s -o /dev/null http://127.0.0.1:5000/led/100/0/0 2>/dev/null

echo "*** UpgrayeDD done"
echo "*** UpgrayeDD took $minutes minutes and $seconds seconds"
echo "*** UpgrayeDD says run ./serverUpgrade.sh on your build box!"